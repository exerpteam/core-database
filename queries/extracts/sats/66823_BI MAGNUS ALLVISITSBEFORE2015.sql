SELECT YEAR, MONTH, PERSON_ID, COUNT(1) AS NUMVISITS
FROM
(
	SELECT 	TO_NUMBER(SUBSTR(CHECK_IN_DATE,0,4)) AS YEAR
		,TO_NUMBER(SUBSTR(CHECK_IN_DATE,6,2)) AS MONTH
		,PERSON_ID
	FROM BI_VISIT_LOG
	WHERE 	ETS < (1316390000000 - (15552000000 * (TRUNC (SYSDATE - date '2019-09-21') - 1)))
		AND ETS > (1316390000000 - (15552000000 * (TRUNC (SYSDATE - date '2019-09-21') - 0)))
		AND CHECK_IN_RESULT <> 'ACCESS_DENIED'
) x
GROUP BY YEAR, MONTH, PERSON_ID