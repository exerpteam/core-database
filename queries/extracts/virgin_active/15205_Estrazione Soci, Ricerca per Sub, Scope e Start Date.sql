-- The extract is extracted from Exerp on 2026-02-08
-- Estrazione soci per Sub, Scope e Start Date
COLONNE: CENTER+ID+FULLNAME+CENTER+COMPANYNAME+EXTERNAL_ID+STATUS+PERSONTYPE+SEX+BLACKLISTED+ADDRESS1+COUNTRY+ZIPCODE+BIRTHDATE+FRIENDS_ALLOWANCE+CITY+PHONEMOBILE+EMAIL
 SELECT DISTINCT P.CENTER, P.ID, P.FULLNAME,C.NAME AS CENTER, (select c.lastname from persons c where c.center = r.center and c.id = r.id ) as companyname, (select curpers.EXTERNAL_ID from persons curpers where curpers.CENTER = p.CURRENT_PERSON_CENTER and curpers.id = p.CURRENT_PERSON_ID) as EXTERNAL_ID, CASE  P.STATUS  WHEN 0 THEN 'Lead'  WHEN 1 THEN 'Active'  WHEN 2 THEN 'Inactive'  WHEN 3 THEN 'Temporary inactive'  WHEN 4 THEN 'Transferred'  WHEN 5 THEN 'Duplicate'  WHEN 6 THEN 'Prospect'  WHEN 7 THEN 'Deleted'  WHEN 8 THEN  'Anonimized'  WHEN 9 THEN  'Contact'  ELSE 'Unknown' END AS STATUS, CASE  P.PERSONTYPE  WHEN 0 THEN 'Private'  WHEN 1 THEN 'Student'  WHEN 2 THEN 'Staff'  WHEN 3 THEN 'Friend'  WHEN 4 THEN 'Corporate'  WHEN 5 THEN 'One man corporate'  WHEN 6 THEN 'Family'  WHEN 7 THEN 'Senior'  WHEN 8 THEN 'Guest' ELSE 'Unknown' END AS PERSONTYPE, P.FIRSTNAME, P.LASTNAME, P.SEX, P.BLACKLISTED, P.ADDRESS1, P.ADDRESS2, P.COUNTRY, P.ZIPCODE, P.BIRTHDATE,P.PINCODE, P.FRIENDS_ALLOWANCE, P.CITY, ph.txtvalue AS phonehome, pm.txtvalue AS phonemobile, pem.txtvalue AS email,P.MIDDLENAME, P.FIRST_ACTIVE_START_DATE, P.LAST_ACTIVE_START_DATE, P.LAST_ACTIVE_END_DATE, P.MEMBERDAYS, P.ACCUMULATED_MEMBERDAYS, case when P.LAST_ACTIVE_START_DATE is null then 0 when P.LAST_ACTIVE_END_DATE is null then trunc(TO_DATE('2016-04-15', 'yyyy-MM-dd') - P.LAST_ACTIVE_START_DATE) + 1 else P.MEMBERDAYS end UNBROKEN_MEMBER_DAYS, case when P.LAST_ACTIVE_END_DATE is null then trunc(TO_DATE('2016-04-15', 'yyyy-MM-dd') - P.LAST_ACTIVE_START_DATE) + 1 + P.ACCUMULATED_MEMBERDAYS else P.ACCUMULATED_MEMBERDAYS + P.MEMBERDAYS end BROKEN_MEMBER_DAYS, E1.identity AS barcode, E2.identity AS magneticcard, E4.identity AS rfcard, E5.identity AS pin FROM PERSONS P LEFT JOIN SUBSCRIPTIONS S ON  P.CENTER = S.OWNER_CENTER  AND P.ID = S.OWNER_ID left join centers c on p.center = c.id left join entityidentifiers E1 on p.center = E1.ref_center and p.id = E1.ref_id and E1.idmethod = 1 and E1.entitystatus = 1 left join entityidentifiers E2 on p.center = E2.ref_center and p.id = E2.ref_id and E2.idmethod = 2 and E2.entitystatus = 1 left join entityidentifiers E4 on p.center = E4.ref_center and p.id = E4.ref_id and E4.idmethod = 4 and E4.entitystatus = 1 left join entityidentifiers E5 on p.center = E5.ref_center and p.id = E5.ref_id and E5.idmethod = 5 and E5.entitystatus = 1 left join relatives r on p.center = r.relativecenter and p.id = r.relativeid and r.rtype = 2 and r.status <> 3 left join person_ext_attrs ph on ph.personcenter = p.center and ph.personid = p.id and ph.name = '_eClub_PhoneHome' left join person_ext_attrs pem on pem.personcenter = p.center and pem.personid = p.id and pem.name = '_eClub_Email' left join person_ext_attrs pm on pm.personcenter = p.center and pm.personid = p.id and pm.name = '_eClub_PhoneSMS' WHERE P.CENTER IN (205,204,207,206,201,203,202,220,221,222,223,216,217,218,219,212,213,214,215,208,209,210,211,102,103,100,101,108,106,107,225,104,224,105,225,226,227,228,229,230,231,232,233) AND (S.SUBSCRIPTIONTYPE_CENTER, S.SUBSCRIPTIONTYPE_ID) in(SELECT center,id FROM PRODUCTS WHERE PTYPE = 10 AND GLOBALID IN ( :globalsubtype ) AND center IN (S.CENTER)) AND p.center IN ($$scope$$) AND S.START_DATE >= :Start_Date_From
