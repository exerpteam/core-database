-- The extract is extracted from Exerp on 2026-02-08
--  
 SELECT             
					c.SHORTNAME,
					p.EXTERNAL_ID,
					p.FULLNAME,
					pr.FULL_REFERENCE,
                    pr.CENTER AS clubId,
					
                    pr.REQ_AMOUNT,
					pr.REQ_DATE,
					pr.REJECTED_REASON_CODE
					
                  
					
			 FROM
                    PAYMENT_REQUESTS pr
INNER JOIN
    ACCOUNT_RECEIVABLES ar
ON pr.CENTER = ar.CENTER
    AND pr.ID = ar.ID

INNER JOIN PERSONS p
ON p.CENTER = ar.CUSTOMERCENTER AND p.ID = ar.CUSTOMERID
INNER JOIN CENTERS c
ON c.ID = pr.CENTER
--LEFT OUTER  JOIN 
--PAYMENT_REQUEST_SPECIFICATIONS ps
--ON ps.CENTER = pr.CENTER
--AND ps.ID = pr.ID
--AND ps.SUBID = pr.SUBID

--INNER JOIN AR_TRANS at
--ON at.PAYREQ_SPEC_SUBID = pr.SUBID
--AND at.PAYREQ_SPEC_ID = pr.ID
--AND at.PAYREQ_SPEC_CENTER = pr.CENTER

					
					WHERE EXTRACT(MONTH FROM pr.REQ_DATE)= $$MONTH$$
					--AND at.DUE_DATE =  trunc(sysdate,'mm')  AND at.COLLECTED_AMOUNT = at.AMOUNT
					--AND ps.CENTER IS NULL
					 AND pr.CLEARINGHOUSE_ID IN (1202,1404,1408,1422,1426,1428,1427,1419,1403,1201,1418,1001,1002,805,1410,1415,1411,
											1420,1409,1412,1406,1423,1421,1413,1414,1405,1401,801,1424,1417,1402,804,1407,1416,1425)
               AND pr.CENTER IN (select c.ID from CENTERS c where  c.COUNTRY = 'IT' )
 AND pr.REQUEST_TYPE = 1
 AND pr.REQ_DELIVERY IS NOT NULL
--AND ar.CUSTOMERCENTER = 106
--AND ar.CUSTOMERID = 7230
AND pr.REJECTED_REASON_CODE IS NOT NULL
ORDER BY c.SHORTNAME, p.FULLNAME