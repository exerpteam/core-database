-- The extract is extracted from Exerp on 2026-02-08
--  
SELECT
	--bk.id,
	TO_CHAR(longtodate(bk.STARTTIME), 'YYYY-MM-DD') dato,
	--c.name,
	 TO_CHAR (longtodate(bk.STARTTIME), 'HH24:MI') AS STARTTIME,
	TO_CHAR (longtodate(bk.STOPTIME), 'HH24:MI') AS STOPTIME,
   	act.NAME activityname,
	c.EXTERNAL_ID as Cost,
    --bk.STATE bookingState,
    CASE
        WHEN ins.CENTER IS NULL
        THEN NULL
        ELSE ins.FIRSTNAME || ' ' || ins.LASTNAME
    END instructorName,
	ins.ssn
	--ins.center || 'p' || ins.id

    
FROM
    BOOKINGS bk
JOIN ACTIVITY act
ON
    bk.ACTIVITY = act.ID

LEFT JOIN STAFF_USAGE st
ON
    bk.center = st.BOOKING_CENTER
    AND bk.id = st.BOOKING_ID
LEFT JOIN PERSONS ins
ON
    st.PERSON_CENTER = ins.CENTER
    AND st.PERSON_ID = ins.ID
	



 
LEFT JOIN Centers c
on
BK.center = c.id 




WHERE

    bk.center IN (543, 539, 541, 542, 535, 501, 502, 512, 513, 515, 516, 517, 518, 519, 523, 524, 525, 526, 527, 528, 529, 536, 537, 511, 522, 530, 531, 532, 533, 534, 538, 544, 545, 546, 547)
    AND act.ACTIVITY_TYPE = '2'





   --AND bk.STARTTIME >= FromDate
    --AND bk.STARTTIME < ToDate + 3600*1000*24

	AND bk.STARTTIME >= datetolong(TO_CHAR(TRUNC(current_timestamp +32), 'YYYY-MM-DD HH24:MI')) -- yesterday at midnight
	AND bk.STARTTIME < datetolong(TO_CHAR(TRUNC(current_timestamp +47), 'YYYY-MM-DD HH24:MI')) + 86399*1000 -- yesterday at midnight +24 hours --in ms



    AND bk.STATE = 'ACTIVE'
	AND st.STATE != 'CANCELLED'

	AND (ins.center, ins.id) NOT IN ((522,54865),(533,17800),(522,704),(542,2202),(522,36264),(536,842),(536,843),(516,3261),(516,3262),(538,1202),(538,1203),(519,1401),(519,1400),(527,2570),(527,2571),(533,949),(533,950),(530,1462),(530,1463),(522,53471),(530,36264),(527,47583),(538,1308),(542,2202),(538,39213),(545,1377),(545,2958),(544,413),(544,415),(545,1377),(544,10603),(544,422),(544,423),(544,606),(545,243),(544,419),(545,3004),(545,202),(544,424),(544,19209),(544,18060),(544,1027),(536,65814),(530,60678),(530,60679),(544,17473),(544,18061),(544,18062),(544,18060),(544,19209),(544,19210),(544,404),(544,34201),(527,81987),(544,16607),(542,38825),
(544,55281),(522,113105),(542,74807),(544,670),(544,62416),(544,54308),(522,117657),(544,62801),(547,11210),(544,74826),(544,75227),(544,401),(542,79825),(542,80023),(527,116584),(545,63607),(544,78416),(545,66202),(545,66408),(544,75227),(546,53201),(544,74612),(544,62205),(527,124990),(542,39836),(527,13202),(545,56809),(544,10244),(544,74612),(522,129875),(536,104218),(522,115460),(522,130475),(544,59042),(527,126814),(527,127020),(542,73003),(544,87405),(538,93207),(544,86586),(544,69004),(527,130584),(511,89839),(538,93207))







ORDER BY
    bk.STARTTIME
